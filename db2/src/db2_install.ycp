/************************************************************************
 *                                                                      *
 *                         __   __    ____ _____                        *
 *                         \ \ / /_ _/ ___|_   _|                       *
 *                          \ V / _` \___ \ | |                         *
 *                           | | (_| |___) || |                         *
 *                           |_|\__,_|____/ |_|                         *
 *                                                                      *
 *                Module for the IBM DB2 Universal Database             *
 *                                                                      *
 ************************************************************************

   Copyright (C) 2003  SUSE LINUX AG, Nuernberg, Germany

   Author:     David Strbac <strbac@suse.de>

   $Id$


   This file is part of yast2_db2setup.

   yast2_db2setup is free software; you can redistribute it and/or
   modify it under the terms of the GNU General Public License as
   published by the Free Software Foundation; either version 2 of the
   License, or (at your option) any later version.

   yast2_db2setup is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
   General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with yast2_db2setup; if not, write to the Free Software
   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307
   USA


 ************************************************************************
 *                                                                      *
 *  FILE:     db2_install.ycp                                           *
 *                                                                      *
 *  FUNCTION: YaST Wizard Sequencer for DB2 Installation and            *
 *            Configuration                                             *
 *                                                                      *
 ***********************************************************************/



{
	include "wizard/sequencer.ycp";

	import "Wizard";
	import "Popup";

	import "./lib/DB2GUI";
	import "./lib/DB2DATA";
	import "./lib/DB2INSTALL";



	/* aliases for the wizard sequencer */
	map Aliases =
	$[
		/* installation dialog funktions */
		"introduction":		``(DB2GUI::stage_1(1, false, true)),
		"license":		``(DB2GUI::stage_2(1, true, true)),
		"inst_type":		``(DB2GUI::stage_3(1, true, true)),
		"inst_action":		``(DB2GUI::stage_4(1, true, true)),
		"das_user":		``(DB2GUI::stage_5(1, true, true)),
		"create_instance":	``(DB2GUI::stage_6(1, true, true)),
		"admin_contact_list":	``(DB2GUI::stage_7(1, true, true)),
		"summary":		``(DB2GUI::stage_8(1, true, true)),

		/* install DB2 */
		"write_response_file":	``(DB2GUI::stage_9()),
		"install_db2":		``(DB2GUI::stage_10(1, false, false)),

		/* results and infos */
		"show_result":		``(DB2GUI::stage_11(1, false, true)),

		/* error or abort functions */
		"error_response_file":	``(install_error("Could not save response file!")),
		"error_install":	``(install_error("Installation error! Log in the log files for detailed information")),
		"abort_install":	``(abort_install())
	];



	/* sequence description */
	map Sequence =
	$[
		"ws_start":	"introduction",
		"introduction":
		$[
			`next:	"license",
			`abort:	"abort_install",
			`cancel:"abort_install"
		],
		"license":
		$[
			`next:	"inst_type",
			`abort:	"abort_install",
			`cancel:"abort_install"
		],
		"inst_type":
		$[
			`next:	"inst_action",
			`abort:	"abort_install",
			`cancel:"abort_install"
		],
		"inst_action":
		$[
			`next:	"das_user",
			`abort:	"abort_install",
			`cancel:"abort_install"
		],
		"das_user":
		$[
			`next:	"create_instance",
			`abort:	"abort_install",
			`cancel:"abort_install"
		],
		"create_instance":
		$[
			`next:	"admin_contact_list",
			`abort:	"abort_install",
			`cancel:"abort_install"
		],
		"admin_contact_list":
		$[
			`next:	"summary",
			`abort:	"abort_install",
			`cancel:"abort_install"
		],
		"summary":
		$[
			`next:	"write_response_file",
			`abort:	"abort_install",
			`cancel:"abort_install"
		],
		"write_response_file":
		$[
			`ok:	"install_db2",
			`error:	"error_response_file"
		],
		"install_db2":
		$[
			`ok:	"show_result",
			`error:	"error_install"
		],
		"show_result":
		$[
			`next:	`ws_finish,
			`abort:	"abort_install",
			`cancel:"abort_install"
		],
		"abort_install":
		$[
			`finished: `ws_finished
		],
		"error_response_file":
		$[
			`abort:	"abort_install",
			`summary: "summary"
		],
		"error_install":
		$[
			`abort:	"abort_install",
			`summary: "summary"
		],
	];



	/* function to handel the "abort" and window manager "close" button */
	define symbol abort_install()
	``{
		if (Popup::YesNo("Really abort?"))
			return(`finished);
		else
			return(`back);
	}

	/* error handling funktion */
	define symbol install_error(string message)
	``{
		if (Popup::AnyQuestion("Error", message, "&Back", "Abo&rt", `focus_yes))
			return(`summary);
		else
			return(`abort);
	}



	/* initial dialog creation */
	Wizard::CreateDialog();



	/* start sequencer */
	return(WizardSequencer(Aliases, Sequence));
}
